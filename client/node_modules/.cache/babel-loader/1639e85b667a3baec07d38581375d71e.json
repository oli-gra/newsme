{"ast":null,"code":"import _slicedToArray from \"/Users/oli-gra/Dev/newsme/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/Users/oli-gra/Dev/newsme/client/src/components/App.js\";\n// Import              <- BLOCK ->\n// Import core packages\nimport React, { useState, useEffect } from 'react';\nimport { useRoutes, navigate } from 'hookrouter';\nimport axios from 'axios'; // Import firebase packages for auth & store\n\nimport withFirebaseAuth from 'react-with-firebase-auth';\nimport * as firebase from 'firebase/app';\nimport 'firebase/auth';\nimport 'firebase/storage'; // Import test framework\n\nimport Enzyme from 'enzyme';\nimport Adapter from 'enzyme-adapter-react-16'; //Import components\n\nimport AddNews from './AddNews';\nimport Navbar from './Navbar';\nimport News from './News';\nimport Profile from './Profile';\nimport Login from './Login';\nimport PostBox from './PostBox';\nimport PopMenu from './PopMenu';\nimport NotFoundPage from './NotFoundPage'; // Import style\n\nimport '../style/app.css';\nimport '../style/dark'; //  Servers                <- BLOCK ->\n\nconst actionCodeSettings = {\n  handleCodeInApp: true,\n  url: 'http://localhost:3000' // React app\n  // Init node server hookup\n\n};\nconst url = 'http://localhost:3003'; // Node server\n// Init testing framework for TTD\n\nEnzyme.configure({\n  adapter: new Adapter()\n}); // Init firebase\n\nfirebase.initializeApp(process.env.firebase || {\n  apiKey: \"AIzaSyAFbIY2s1Xw030USr8q3oFu0uLjFtuMM88\",\n  authDomain: \"newsme-070619.firebaseapp.com\",\n  databaseURL: \"https://newsme-070619.firebaseio.com\",\n  projectId: \"newsme-070619\",\n  storageBucket: \"newsme-070619.appspot.com\",\n  messagingSenderId: \"689435092877\",\n  appId: \"1:689435092877:web:dcf194cc284eee61\"\n});\nconst firebaseAppAuth = firebase.auth(); // const providers = { googleProvider: new firebase.auth.GoogleAuthProvider(), }\n\nconst App = ({\n  user,\n  signOut\n}) => {\n  // State\n  const _useState = useState([]),\n        _useState2 = _slicedToArray(_useState, 2),\n        news = _useState2[0],\n        setNews = _useState2[1];\n\n  const _useState3 = useState(false),\n        _useState4 = _slicedToArray(_useState3, 2),\n        postbox = _useState4[0],\n        setPostbox = _useState4[1];\n\n  const _useState5 = useState(null),\n        _useState6 = _slicedToArray(_useState5, 2),\n        newsposts = _useState6[0],\n        setNewsposts = _useState6[1];\n\n  const _useState7 = useState(false),\n        _useState8 = _slicedToArray(_useState7, 2),\n        popmenu = _useState8[0],\n        setPopmenu = _useState8[1];\n\n  const _useState9 = useState([]),\n        _useState10 = _slicedToArray(_useState9, 2),\n        found = _useState10[0],\n        setFound = _useState10[1];\n\n  const email = window.localStorage.getItem('emailForSignIn');\n  useEffect(() => {\n    if (user) {\n      axios.get(url + '/news?uid=' + user.uid).then(res => setNews(res.data));\n    }\n  }, [user]);\n\n  const getBlasts = () => axios.get(\"\".concat(url, \"/blasts?uid=\").concat(user.uid));\n\n  const getNews = () => axios.get(url + '/news?uid=' + user.uid).then(res => setNews(res.data));\n\n  const followUser = fid => {\n    axios.post(\"\".concat(url, \"/follows?uid=\").concat(user.uid, \"&fid=\").concat(fid));\n  };\n\n  const getFollows = () => axios.get(\"\".concat(url, \"/follows?uid=\").concat(user.uid));\n\n  const postUser = puser => {\n    if (!puser) {\n      puser = {\n        uid: user.uid,\n        displayName: user.displayName,\n        email: user.email,\n        emailVerified: user.emailVerified,\n        photoURL: user.photoURL,\n        location: ''\n      };\n    }\n\n    axios.post(url + '/users', puser).catch(err => console.log(err));\n  };\n\n  useEffect(() => {\n    if (!email && firebase.auth().isSignInWithEmailLink(window.location.href)) {\n      return navigate('/');\n    }\n\n    if (email && firebase.auth().signInWithEmailLink(email, window.location.href).then(() => window.localStorage.removeItem('emailForSignIn')).then(() => postUser()).then(() => navigate('/')).catch(error => console.log(error))) {}\n  }, [email, postUser]);\n\n  const getLikes = () => axios.get(\"\".concat(url, \"/likes?uid=\").concat(user.uid)); // like news\n\n\n  const updateNews = nid => axios.patch(url + '/news?uid=' + user.uid + '&nid=' + nid).then(res => {\n    const likedNews = res.data.value;\n    setNews(news.map(n => n._id === likedNews._id ? n = likedNews : n));\n  }).catch(err => console.log(err));\n\n  const searchNews = search => {\n    axios.get(url + \"/search?q=\".concat(search)).then(res => setFound(res.data));\n  };\n\n  const postNews = news => axios.post(url + '/news', news).then(res => setNews([res.data.ops[0], ...news])).catch(err => console.log(err));\n\n  const postUrl = newsUrl => axios.post(url + \"/news/url?url=\".concat(newsUrl, \"&uid=\").concat(user.uid)).then(res => setNews([res.data.ops[0], ...news])).catch(err => console.log(err));\n\n  const getUsersNews = uid => axios.get(url + '/news?uid=' + uid).then(res => setFound(res.data)); // Helpers       <- BLOCK ->\n\n\n  const handleUrl = url => {\n    postUrl(url);\n    return navigate('/');\n  };\n\n  const handleFile = (file, title) => {\n    const storageRef = firebase.storage().ref();\n    const imageRef = storageRef.child(file.name);\n    imageRef.put(file).then(() => console.log(\"\\u2705 uploaded \".concat(imageRef.fullPath))).then(() => storageRef.child(file.name).getDownloadURL()).then(url => postNews({\n      title: title,\n      image: url,\n      uid: user.uid\n    }));\n    return navigate('/');\n  };\n\n  const handleLogin = email => {\n    firebase.auth().sendSignInLinkToEmail(email, actionCodeSettings).then(() => window.localStorage.setItem('emailForSignIn', email)).then(() => navigate('/')).catch(error => console.log(error));\n  };\n\n  const handlePostBox = newsId => {\n    setNewsposts(newsId);\n    return setPostbox(!postbox);\n  };\n\n  const handlePopMenu = () => setPopmenu(!popmenu); // Render logic               <- BLOCK ->\n\n\n  let postboxComponent;\n  let popmenuComponent;\n  let getlinkComponent;\n  let navbarComponent;\n  let routes;\n  let showNews;\n\n  if (postbox) {\n    postboxComponent = React.createElement(PostBox, {\n      handlePostBox: handlePostBox,\n      userId: user.uid,\n      newsId: newsposts,\n      getNews: getNews,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 199\n      },\n      __self: this\n    });\n  }\n\n  if (popmenu) {\n    popmenuComponent = React.createElement(PopMenu, {\n      handlePopMenu: handlePopMenu,\n      signOut: signOut,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    });\n  }\n\n  found.length > 0 ? showNews = found : showNews = news; // Routing               <- BLOCK ->\n\n  if (user) {\n    routes = {\n      '/': () => React.createElement(News, {\n        followUser: followUser,\n        getNews: getUsersNews,\n        news: showNews,\n        handlePostBox: handlePostBox,\n        handleNewsLike: updateNews,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 219\n        },\n        __self: this\n      }),\n      '/login': () => React.createElement(Login, {\n        handleLogin: handleLogin,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 226\n        },\n        __self: this\n      }),\n      '/profile': () => React.createElement(Profile, {\n        postUser: postUser,\n        fuser: user,\n        getLikes: getLikes,\n        getFollows: getFollows,\n        getBlasts: getBlasts,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 229\n        },\n        __self: this\n      }),\n      '/new': () => React.createElement(AddNews, {\n        handleUrl: handleUrl,\n        handleFile: handleFile,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 236\n        },\n        __self: this\n      })\n    };\n    navbarComponent = React.createElement(Navbar, {\n      searchNews: searchNews,\n      popmenu: handlePopMenu,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    });\n  } else {\n    routes = {\n      '/': () => React.createElement(Login, {\n        handleLogin: handleLogin,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 246\n        },\n        __self: this\n      })\n    };\n  }\n\n  const routeResult = useRoutes(routes);\n  return React.createElement(React.Fragment, null, getlinkComponent, navbarComponent, postboxComponent, popmenuComponent, routeResult || React.createElement(NotFoundPage, {\n    user: user,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 259\n    },\n    __self: this\n  }));\n};\n\nexport default withFirebaseAuth({\n  // providers,\n  firebaseAppAuth\n})(App);","map":{"version":3,"sources":["/Users/oli-gra/Dev/newsme/client/src/components/App.js"],"names":["React","useState","useEffect","useRoutes","navigate","axios","withFirebaseAuth","firebase","Enzyme","Adapter","AddNews","Navbar","News","Profile","Login","PostBox","PopMenu","NotFoundPage","actionCodeSettings","handleCodeInApp","url","configure","adapter","initializeApp","process","env","apiKey","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","firebaseAppAuth","auth","App","user","signOut","news","setNews","postbox","setPostbox","newsposts","setNewsposts","popmenu","setPopmenu","found","setFound","email","window","localStorage","getItem","get","uid","then","res","data","getBlasts","getNews","followUser","fid","post","getFollows","postUser","puser","displayName","emailVerified","photoURL","location","catch","err","console","log","isSignInWithEmailLink","href","signInWithEmailLink","removeItem","error","getLikes","updateNews","nid","patch","likedNews","value","map","n","_id","searchNews","search","postNews","ops","postUrl","newsUrl","getUsersNews","handleUrl","handleFile","file","title","storageRef","storage","ref","imageRef","child","name","put","fullPath","getDownloadURL","image","handleLogin","sendSignInLinkToEmail","setItem","handlePostBox","newsId","handlePopMenu","postboxComponent","popmenuComponent","getlinkComponent","navbarComponent","routes","showNews","length","routeResult"],"mappings":"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","sourcesContent":["// Import              <- BLOCK ->\n\n// Import core packages\nimport React, { useState, useEffect } from 'react'\nimport { useRoutes, navigate } from 'hookrouter'\nimport axios from 'axios'\n\n// Import firebase packages for auth & store\nimport withFirebaseAuth from 'react-with-firebase-auth'\nimport * as firebase from 'firebase/app'\nimport 'firebase/auth'\nimport 'firebase/storage'\n\n// Import test framework\nimport Enzyme from 'enzyme'\nimport Adapter from 'enzyme-adapter-react-16'\n\n//Import components\nimport AddNews from './AddNews'\nimport Navbar from './Navbar'\nimport News from './News'\nimport Profile from './Profile'\nimport Login from './Login'\nimport PostBox from './PostBox'\nimport PopMenu from './PopMenu'\nimport NotFoundPage from './NotFoundPage'\n\n// Import style\nimport '../style/app.css'\nimport '../style/dark'\n\n//  Servers                <- BLOCK ->\nconst actionCodeSettings = {\n  handleCodeInApp: true,\n  url: 'http://localhost:3000', // React app\n}\n// Init node server hookup\nconst url = 'http://localhost:3003' // Node server\n\n// Init testing framework for TTD\nEnzyme.configure({ adapter: new Adapter() })\n\n// Init firebase\nfirebase.initializeApp(process.env.firebase || {\n  apiKey: \"AIzaSyAFbIY2s1Xw030USr8q3oFu0uLjFtuMM88\",\n  authDomain: \"newsme-070619.firebaseapp.com\",\n  databaseURL: \"https://newsme-070619.firebaseio.com\",\n  projectId: \"newsme-070619\",\n  storageBucket: \"newsme-070619.appspot.com\",\n  messagingSenderId: \"689435092877\",\n  appId: \"1:689435092877:web:dcf194cc284eee61\"\n})\nconst firebaseAppAuth = firebase.auth()\n// const providers = { googleProvider: new firebase.auth.GoogleAuthProvider(), }\n\nconst App = ({ user, signOut }) => {\n\n  // State\n  const [news, setNews] = useState([])\n  const [postbox, setPostbox] = useState(false)\n  const [newsposts, setNewsposts] = useState(null)\n  const [popmenu, setPopmenu] = useState(false)\n  const [found, setFound] = useState([])\n\n  const email = window.localStorage.getItem('emailForSignIn')\n\n  useEffect(() => {\n    if (user) {\n      axios.get(url + '/news?uid=' + user.uid)\n        .then(res => setNews(res.data))\n    }\n  }, [user])\n\n  const getBlasts = () =>\n    axios.get(`${url}/blasts?uid=${user.uid}`)\n\n  const getNews = () =>\n    axios.get(url + '/news?uid=' + user.uid)\n      .then(res => setNews(res.data))\n\n  const followUser = fid => {\n    axios.post(`${url}/follows?uid=${user.uid}&fid=${fid}`)\n  }\n\n  const getFollows = () =>\n    axios.get(`${url}/follows?uid=${user.uid}`)\n\n\n  const postUser = puser => {\n    if (!puser) {\n      puser = {\n        uid: user.uid,\n        displayName: user.displayName,\n        email: user.email,\n        emailVerified: user.emailVerified,\n        photoURL: user.photoURL,\n        location: ''\n      }\n    }\n    axios.post(url + '/users', puser)\n      .catch(err => console.log(err))\n  }\n\n  useEffect(() => {\n    if (!email && firebase.auth().isSignInWithEmailLink(window.location.href)) {\n      return navigate('/')\n    }\n    if (email && firebase.auth().signInWithEmailLink(email, window.location.href)\n      .then(() => window.localStorage.removeItem('emailForSignIn'))\n      .then(() => postUser())\n      .then(() => navigate('/'))\n      .catch(error => console.log(error))) {\n    }\n  }, [email, postUser])\n\n  const getLikes = () =>\n    axios.get(`${url}/likes?uid=${user.uid}`)\n\n\n  // like news\n  const updateNews = nid =>\n    axios.patch(url + '/news?uid=' + user.uid + '&nid=' + nid)\n      .then(res => {\n        const likedNews = res.data.value\n        setNews(news.map(n =>\n          n._id === likedNews._id\n            ? n = likedNews\n            : n\n        ))\n      })\n      .catch(err => console.log(err))\n\n\n  const searchNews = search => {\n    axios.get(url + `/search?q=${search}`)\n      .then(res => setFound(res.data))\n  }\n\n  const postNews = news =>\n    axios.post(url + '/news', news)\n      .then(res => setNews([res.data.ops[0], ...news]))\n      .catch(err => console.log(err))\n\n  const postUrl = newsUrl =>\n    axios.post(url + `/news/url?url=${newsUrl}&uid=${user.uid}`)\n      .then(res => setNews([res.data.ops[0], ...news]))\n      .catch(err => console.log(err))\n\n  const getUsersNews = uid =>\n    axios.get(url + '/news?uid=' + uid)\n      .then(res => setFound(res.data))\n\n  // Helpers       <- BLOCK ->\n\n  const handleUrl = url => {\n    postUrl(url)\n    return navigate('/')\n  }\n\n  const handleFile = (file, title) => {\n    const storageRef = firebase.storage().ref()\n    const imageRef = storageRef.child(file.name)\n    imageRef.put(file)\n      .then(() => console.log(`✅ uploaded ${imageRef.fullPath}`))\n      .then(() => storageRef.child(file.name).getDownloadURL())\n      .then(url => postNews({\n        title: title,\n        image: url,\n        uid: user.uid\n      }))\n    return navigate('/')\n  }\n\n  const handleLogin = email => {\n    firebase.auth().sendSignInLinkToEmail(email, actionCodeSettings)\n      .then(() => window.localStorage.setItem('emailForSignIn', email))\n      .then(() => navigate('/'))\n      .catch(error => console.log(error))\n  }\n\n  const handlePostBox = newsId => {\n    setNewsposts(newsId)\n    return setPostbox(!postbox)\n  }\n\n  const handlePopMenu = () =>\n    setPopmenu(!popmenu)\n\n  // Render logic               <- BLOCK ->\n\n  let postboxComponent\n  let popmenuComponent\n  let getlinkComponent\n  let navbarComponent\n  let routes\n  let showNews\n\n  if (postbox) {\n    postboxComponent = <PostBox\n      handlePostBox={handlePostBox}\n      userId={user.uid}\n      newsId={newsposts}\n      getNews={getNews}\n    />\n  }\n  if (popmenu) {\n    popmenuComponent = <PopMenu\n      handlePopMenu={handlePopMenu}\n      signOut={signOut}\n    />\n  }\n\n  found.length > 0 ? showNews = found : showNews = news\n\n  // Routing               <- BLOCK ->\n\n  if (user) {\n    routes = {\n      '/': () => <News\n        followUser={followUser}\n        getNews={getUsersNews}\n        news={showNews}\n        handlePostBox={handlePostBox}\n        handleNewsLike={updateNews}\n      />,\n      '/login': () => <Login\n        handleLogin={handleLogin}\n      />,\n      '/profile': () => <Profile\n        postUser={postUser}\n        fuser={user}\n        getLikes={getLikes}\n        getFollows={getFollows}\n        getBlasts={getBlasts}\n      />,\n      '/new': () => <AddNews\n        handleUrl={handleUrl}\n        handleFile={handleFile}\n      />\n    }\n    navbarComponent = <Navbar\n      searchNews={searchNews}\n      popmenu={handlePopMenu} />\n  } else {\n    routes = {\n      '/': () => <Login\n        handleLogin={handleLogin}\n      />,\n    }\n  }\n\n  const routeResult = useRoutes(routes)\n  return (\n    <>\n      {getlinkComponent}\n      {navbarComponent}\n      {postboxComponent}\n      {popmenuComponent}\n      {routeResult || <NotFoundPage user={user} />}\n    </>\n  )\n}\n\nexport default withFirebaseAuth({\n  // providers,\n  firebaseAppAuth,\n})(App)"]},"metadata":{},"sourceType":"module"}